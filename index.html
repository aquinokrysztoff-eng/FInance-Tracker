<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Personal Finance Tracker</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: background 0.3s, color 0.3s;
}

h1 {
  background: #4CAF50;
  color: white;
  padding: 8px 16px;
  border-radius: 50px;
  margin-bottom: 20px;
}

.main-container {
  display: flex;
  gap: 20px;
  width: 100%;
  max-width: 1100px;
}

.form-box, .records-box {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 15px rgba(0,0,0,0.1);
  transition: background 0.3s, color 0.3s;
}

.form-box { flex: 1; min-width: 300px; }
.records-box { flex: 2; min-width: 450px; }

.form-row {
  display: flex;
  gap: 10px;
}

.form-row input {
  flex: 1;
}

input, select, textarea, button {
  width: 100%;
  padding: 10px;
  margin: 5px 0;
  box-sizing: border-box;
}

textarea {
  resize: vertical;
  min-height: 60px;
  max-height: 120px;
}

button {
  background: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover { background: #45a049; }

.record {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 10px;
  margin: 5px 0;
  border-radius: 5px;
}

.record span {
  flex: 1;
  word-break: break-word;
}

.record.income { background: #d4edda; }
.record.expense { background: #f8d7da; }

.actions {
  display: flex;
  gap: 5px;
}

.edit-btn, .delete-btn {
  width: 36px;
  height: 36px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
}

.edit-btn { background: #3498db; }
.edit-btn:hover { background: #2980b9; }

.delete-btn { background: #e74c3c; }
.delete-btn:hover { background: #c0392b; }

.summary-container {
  border: 1px solid #ddd;
  border-radius: 10px;
  margin-bottom: 15px;
}

.summary-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 10px;
  background: #e9ecef;
  border-radius: 10px 10px 0 0;
}

.summary-content {
  padding: 10px;
}

.summary-container.collapsed .summary-content {
  display: none;
}

.toggle-btn {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: #4CAF50;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  padding: 0;
}

.total {
  text-align: center;
  font-weight: bold;
  margin-top: 15px;
}

body.dark {
  background: #121212;
  color: #e0e0e0;
}

body.dark .form-box,
body.dark .records-box {
  background: #1f1f1f;
  color: #e0e0e0;
}

body.dark input,
body.dark select,
body.dark textarea {
  background: #2c2c2c;
  color: white;
  border: 1px solid #444;
}

body.dark .summary-header {
  background: #2a2a2a;
}

body.dark .record.income { background: #1e3a2a; }
body.dark .record.expense { background: #3a1e1e; }

#darkModeBtn {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 60px;
  height: 30px;
  border-radius: 15px;
  background: #333;
  color: white;
  border: none;
  cursor: pointer;
  font-size: 12px;
}
</style>
</head>

<body>

<h1>Personal Finance Tracker</h1>

<div class="main-container">
  <div class="form-box">
    <div class="form-row">
      <input type="date" id="date">
      <button onclick="setToday()">Today</button>
    </div>

    <input type="number" id="amount" placeholder="Amount (₱)">
    <textarea id="description" placeholder="Description"></textarea>

    <select id="type" onchange="toggleCategory()">
      <option value="expense">Expense</option>
      <option value="income">Income</option>
    </select>

    <select id="category">
      <option value="Food">Food</option>
      <option value="Transport">Transport</option>
      <option value="Gaming">Gaming</option>
      <option value="School">School</option>
      <option value="Others">Others</option>
    </select>

    <button onclick="saveRecord()">Save Record</button>
  </div>

  <div class="records-box">
    <div class="summary-container collapsed" id="summaryBox">
      <div class="summary-header">
        <strong>Summary</strong>
        <button class="toggle-btn" onclick="toggleSummary()">▶</button>
      </div>

      <div class="summary-content">
        <select id="summaryMonthFilter">
          <option value="">All Months</option>
          <option value="01">January</option>
          <option value="02">February</option>
          <option value="03">March</option>
          <option value="04">April</option>
          <option value="05">May</option>
          <option value="06">June</option>
          <option value="07">July</option>
          <option value="08">August</option>
          <option value="09">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>

        <select id="summaryYearFilter">
          <option value="">All Years</option>
        </select>

        <button onclick="calculateSummary()">Filter Records</button>
        <button onclick="downloadPDF()">Download PDF</button>
      </div>
    </div>

    <div id="recordList"></div>
    <div class="total" id="totalAmount"></div>
  </div>
</div>

<button id="darkModeBtn" onclick="toggleDarkMode()">Off</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let records = JSON.parse(localStorage.getItem("records")) || [];
let editIndex = null;

const dateInput = document.getElementById("date");
const amountInput = document.getElementById("amount");
const descriptionInput = document.getElementById("description");
const typeInput = document.getElementById("type");
const categoryInput = document.getElementById("category");
const summaryMonthFilter = document.getElementById("summaryMonthFilter");
const summaryYearFilter = document.getElementById("summaryYearFilter");
const recordList = document.getElementById("recordList");
const totalAmount = document.getElementById("totalAmount");

function setToday() {
  dateInput.value = new Date().toISOString().slice(0,10);
}

function toggleCategory() {
  categoryInput.style.display = typeInput.value === "income" ? "none" : "block";
}
toggleCategory();

function toggleSummary() {
  const box = document.getElementById("summaryBox");
  const btn = box.querySelector(".toggle-btn");
  box.classList.toggle("collapsed");
  btn.textContent = box.classList.contains("collapsed") ? "▶" : "◀";
}

function toggleDarkMode() {
  document.body.classList.toggle("dark");
}

function saveRecord() {
  const record = {
    date: dateInput.value,
    amount: Number(amountInput.value),
    type: typeInput.value,
    category: typeInput.value === "expense" ? categoryInput.value : "Income",
    description: descriptionInput.value
  };
  if (!record.date || record.amount <= 0) return alert("Invalid input");
  records.push(record);
  localStorage.setItem("records", JSON.stringify(records));
  populateYears();
  renderRecords(records);
  amountInput.value = "";
  descriptionInput.value = "";
}

function sortByDate(list) {
  return list.slice().sort((a,b)=> new Date(a.date)-new Date(b.date));
}

function renderRecords(list) {
  recordList.innerHTML = "";
  let spent=0, earned=0;
  sortByDate(list).forEach(r=>{
    if(r.type==="expense") spent+=r.amount; else earned+=r.amount;
    const div=document.createElement("div");
    div.className="record "+r.type;
    div.innerHTML=`<span>${r.date} | ${r.category} | ₱${r.amount} | ${r.description||""}</span>`;
    recordList.appendChild(div);
  });
  totalAmount.textContent=`Earned: ₱${earned} | Spent: ₱${spent} | Net: ₱${earned-spent}`;
}

function populateYears() {
  const years=[...new Set(records.map(r=>r.date.split("-")[0]))];
  summaryYearFilter.innerHTML='<option value="">All Years</option>';
  years.forEach(y=>{
    const opt=document.createElement("option");
    opt.value=y; opt.textContent=y;
    summaryYearFilter.appendChild(opt);
  });
}

function calculateSummary() {
  const m=summaryMonthFilter.value;
  const y=summaryYearFilter.value;
  const filtered=records.filter(r=>{
    const [yr,mo]=r.date.split("-");
    if(m && mo!==m) return false;
    if(y && yr!==y) return false;
    return true;
  });
  renderRecords(filtered);
}

function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const m=summaryMonthFilter.value;
  const y=summaryYearFilter.value;
  const filtered=records.filter(r=>{
    const [yr,mo]=r.date.split("-");
    if(m && mo!==m) return false;
    if(y && yr!==y) return false;
    return true;
  });
  let yPos=20;
  let spent=0,earned=0;
  doc.setFontSize(18);
  doc.text("Personal Finance Records",105,yPos,{align:"center"});
  yPos+=10;
  doc.setFontSize(10);
  doc.text(`Month: ${m||"All"}  Year: ${y||"All"}`,14,yPos);
  yPos+=8;
  doc.text("Date",14,yPos); doc.text("Type",45,yPos); doc.text("Category",70,yPos); doc.text("Amount",115,yPos); doc.text("Description",145,yPos);
  yPos+=4; doc.line(14,yPos,195,yPos); yPos+=6;
  sortByDate(filtered).forEach(r=>{
    if(r.type==="expense") spent+=r.amount; else earned+=r.amount;
    doc.text(r.date,14,yPos); doc.text(r.type,45,yPos); doc.text(r.category,70,yPos); doc.text("₱"+r.amount,115,yPos); doc.text(r.description||"-",145,yPos);
    yPos+=6; if(yPos>270){doc.addPage(); yPos=20;}
  });
  yPos+=8; doc.line(14,yPos,195,yPos); yPos+=8;
  doc.text("Earned: ₱"+earned,14,yPos); yPos+=6; doc.text("Spent: ₱"+spent,14,yPos); yPos+=6; doc.text("Net: ₱"+(earned-spent),14,yPos);
  doc.save(`Finance_${m||"All"}_${y||"All"}.pdf`);
}

populateYears();
renderRecords(records);
</script>

</body>
</html>
